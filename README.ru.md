# Clicks Counter

 Сервис для подсчёта кликов по баннерам с буферизацией в Redis и агрегацией в PostgreSQL.

## 📦 Возможности

- 📈 Подсчёт кликов по баннерам через `/counter/{bannerID}`
- 📊 Получение статистики по баннеру за указанный период `/stats/{bannerID}`
- 🧮 Получение полной статистики по всем баннерам `/stats/all-stats`
- ⚡ Высокая производительность с использованием Redis
- 💾 Агрегированная запись в PostgreSQL
- 🛡 Rate limiter (500 RPS)
- 📚 Swagger-документация доступна по `/swagger/index.html`

---

## ⚙️ Архитектура

```
                ┌────────────┐
                │   Client   │
                └─────┬──────┘
                      │ HTTP (Gin)
                ┌─────▼──────┐
                │  Delivery  │  ← HTTP-обработчики, Swagger
                └─────┬──────┘
                      │
                ┌─────▼──────┐
                │  UseCase   │  ← Бизнес-логика
                └─────┬──────┘
                      │
            ┌─────────▼─────────┐
            │     Repository    │  ← Работа с Redis и PostgreSQL
            └────────┬──────────┘
                     │
       ┌─────────────▼─────────────┐
       │ Redis (временное хранилище)│ ← кэш для скорости
       └─────────────┬─────────────┘
                     │
         ┌───────────▼───────────┐
         │ PostgreSQL (хранилище)│ ← финальная агрегация
         └───────────────────────┘
```

---

## 🚀 Быстрый старт

Убедитесь, что у вас установлен `Docker`, `Make`, `Go`, `Swag`.

### Запуск сервиса

```bash
make up
```

По умолчанию используется файл окружения: `./envs/.env.dev`.

### Остановка сервиса

```bash
make down
```

### Перезапуск

```bash
make restart
```

---

## 🛠 Разработка

### Сборка бинарника

```bash
make build
```

### Запуск приложения локально

```bash
make run
```

### Форматирование, валидация и зависимости

```bash
make fmt     # go fmt ./...
make vet     # go vet ./...
make tidy    # go mod tidy
```

### Запуск тестов

```bash
make test
```

---

## 📚 Swagger-документация

Сгенерировать:

```bash
make swag
```

После запуска доступно по адресу:

```
http://localhost:3000/swagger/index.html
```

---

## ⚡ Производительность

| Нагрузка | Поведение |
|----------|-----------|
| 50 RPS   | Обслуживается стандартным пулом соединений (20–50), без проблем |
| 500 RPS  | Необходим тюнинг PostgreSQL (max_connections), увеличение Redis TTL, возможны задержки записи без агрегации |

- Redis уменьшает нагрузку на PostgreSQL путём буферизации.
- Сервис агрегирует Redis-ключи раз в минуту и делает **batch insert** в базу.

---

## 📝 Пример Makefile команд

```bash
make up      # поднять контейнеры
make logs    # посмотреть логи
make swag    # сгенерировать Swagger
make build   # собрать Go-бинарник
```

---

## 📁 Структура проекта

```
.
├── cmd/app              # entry-point и инициализация зависимостей
├── configs              # конфигурация приложения
├── internal
│   ├── delivery         # HTTP-эндпоинты (Gin)
│   ├── usecase          # бизнес-логика
│   └── repository       # работа с Redis/PostgreSQL
├── docs                 # Swagger-файлы
├── envs                 # .env файлы
├── Makefile             # команды сборки/запуска
└── docker-compose.yml   # Docker-инфраструктура
```

---
